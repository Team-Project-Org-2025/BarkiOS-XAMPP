â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INSTALACIÃ“N DEL MÃ“DULO DE COMPRAS
   Garage Barki - Sistema BarkiOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ARCHIVOS CREADOS:

1. MODELO (Backend)
   ğŸ“ app/models/Purchase.php
   - Gestiona operaciones CRUD de compras
   - IntegraciÃ³n con proveedores y cuentas por pagar
   - MÃ©todos: getAll(), add(), update(), delete(), etc.

2. CONTROLADOR (Backend)
   ğŸ“ app/controllers/Admin/PurchaseController.php
   - Maneja peticiones AJAX
   - Validaciones completas de datos
   - BÃºsqueda de proveedores
   - GestiÃ³n de estados

3. VISTA (Frontend)
   ğŸ“ app/views/admin/purchase-admin.php
   - Interfaz completa de usuario
   - Modal de agregar compra con mÃºltiples productos
   - Tabla interactiva con bÃºsqueda
   - Dashboard de estadÃ­sticas

4. JAVASCRIPT
   ğŸ“ public/assets/js/purchase-admin.js
   - BÃºsqueda en tiempo real de proveedores
   - GestiÃ³n dinÃ¡mica de productos
   - CÃ¡lculo automÃ¡tico de totales
   - ValidaciÃ³n de formularios

5. BASE DE DATOS
   ğŸ“ database/create_compras.sql
   - Tabla 'compras' (encabezado)
   - Tabla 'detalle_compra' (productos)
   - Vista 'vista_compras' (reportes)
   - Triggers automÃ¡ticos
   - Procedimientos almacenados

6. DOCUMENTACIÃ“N
   ğŸ“ docs/MODULO_COMPRAS_README.md
   - GuÃ­a completa del mÃ³dulo
   - Endpoints documentados
   - Troubleshooting


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PASOS DE INSTALACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: CREAR TABLAS EN LA BASE DE DATOS
----------------------------------------
1. Abre phpMyAdmin (http://localhost/phpmyadmin)
2. Selecciona la base de datos: barkios_db
3. Ve a la pestaÃ±a "SQL"
4. Copia y pega el contenido de:
   database/create_compras.sql
5. Haz clic en "Continuar"

âœ… Resultado esperado:
   - Tabla "compras" creada
   - Tabla "detalle_compra" creada
   - Vista "vista_compras" creada
   - Triggers creados
   - Procedimientos "sp_estadisticas_compras" y "sp_detalle_compra"


PASO 2: VERIFICAR INSTALACIÃ“N
------------------------------
Ejecuta estos comandos SQL:

-- Ver tablas creadas
SHOW TABLES LIKE '%compra%';

-- Ver estructura de compras
DESCRIBE compras;

-- Ver estructura de detalle
DESCRIBE detalle_compra;

-- Probar procedimiento de estadÃ­sticas
CALL sp_estadisticas_compras();

-- Ver vista de reportes
SELECT * FROM vista_compras;


PASO 3: CONFIGURAR RUTAS (SI ES NECESARIO)
-------------------------------------------
Verifica que en tu archivo de rutas exista:

// En index.php o router
case '/admin/compras':
case '/admin/purchases':
    require_once __DIR__ . '/app/controllers/Admin/PurchaseController.php';
    break;


PASO 4: PROBAR EL MÃ“DULO
-------------------------
1. Inicia XAMPP (Apache + MySQL)
2. Navega a: http://localhost/BarkiOS/admin/compras
3. DeberÃ­as ver la interfaz de Compras


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATOS DE PRUEBA (OPCIONAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si necesitas datos de prueba:

-- 1. Crear proveedor de prueba (si no existe)
INSERT INTO proveedores (id, nombre_empresa, nombre_contacto, direccion, tipo_rif, activo)
VALUES ('J987654321', 'Fashion Imports USA', 'John Smith', 'Miami, Florida 33101', 'J', 1);

-- 2. Crear compra de prueba
INSERT INTO compras 
  (proveedor_id, factura_numero, tracking, tipo_compra, metodo_pago, 
   subtotal, descuento, monto_total, estado_compra)
VALUES 
  ('J987654321', 'FACT-USA-2025-001', 'TRACK123456', 'credito', 'transferencia',
   5000.00, 100.00, 4900.00, 'en_transito');

-- 3. Obtener el ID de la compra creada
SET @compra_id = LAST_INSERT_ID();

-- 4. Agregar productos de prueba
INSERT INTO detalle_compra (compra_id, producto_nombre, producto_descripcion, cantidad, precio_unitario)
VALUES 
  (@compra_id, 'Jeans Levi''s 501', 'Talla 32, Color Azul', 10, 45.00),
  (@compra_id, 'Camisa Ralph Lauren', 'Talla M, Color Blanco', 15, 55.00),
  (@compra_id, 'Zapatos Nike Air Max', 'Talla 42, Color Negro', 8, 120.00);

-- 5. Verificar
SELECT * FROM vista_compras WHERE compra_id = @compra_id;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARACTERÃSTICAS DEL MÃ“DULO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… REGISTRO DE COMPRAS:
   - NÂ° de Factura Ãºnico
   - BÃºsqueda de proveedores en tiempo real
   - MÃºltiples productos por compra
   - Tracking de envÃ­o
   - Tipo: Contado o CrÃ©dito
   - MÃ©todos de pago mÃºltiples
   - CÃ¡lculo automÃ¡tico de totales

âœ… GESTIÃ“N DE PRODUCTOS:
   - Agregar/eliminar productos dinÃ¡micamente
   - Nombre y descripciÃ³n
   - Cantidad y precio unitario
   - Subtotal calculado automÃ¡ticamente

âœ… ESTADOS DE COMPRA:
   ğŸ”µ En Espera     - Compra registrada
   ğŸ”µ En TrÃ¡nsito   - MercancÃ­a en camino
   ğŸŸ¡ Recibida      - MercancÃ­a llegÃ³
   ğŸŸ¢ Inventario    - Productos en sistema
   ğŸ”´ Cancelada     - Compra anulada

âœ… DASHBOARD DE ESTADÃSTICAS:
   - Total de compras
   - Compras en trÃ¡nsito
   - Compras recibidas
   - Monto total invertido

âœ… TABLA INTERACTIVA:
   - BÃºsqueda por factura, proveedor o tracking
   - Ver detalles completos
   - Actualizar estado
   - Cancelar compra


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTRUCTURA DE LA BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TABLA: compras
+------------------+---------------+-------------------------------+
| Campo            | Tipo          | DescripciÃ³n                   |
+------------------+---------------+-------------------------------+
| compra_id        | INT(11)       | ID Ãºnico (auto-increment)     |
| proveedor_id     | VARCHAR(12)   | RIF del proveedor             |
| factura_numero   | VARCHAR(50)   | NÃºmero de factura (Ãºnico)     |
| fecha_compra     | DATETIME      | Fecha/hora de registro        |
| tracking         | VARCHAR(100)  | NÃºmero de seguimiento         |
| tipo_compra      | ENUM          | contado / credito             |
| metodo_pago      | ENUM          | efectivo, transferencia, etc. |
| subtotal         | DECIMAL(12,2) | Suma de productos             |
| descuento        | DECIMAL(12,2) | Descuento aplicado            |
| monto_total      | DECIMAL(12,2) | Total a pagar                 |
| estado_compra    | ENUM          | en_espera, en_transito, etc.  |
| observaciones    | TEXT          | Notas adicionales             |
| activo           | TINYINT(1)    | 1=activo, 0=cancelado         |
| created_at       | TIMESTAMP     | Fecha de creaciÃ³n             |
| updated_at       | TIMESTAMP     | Ãšltima actualizaciÃ³n          |
+------------------+---------------+-------------------------------+

FOREIGN KEY: proveedor_id â†’ proveedores(id)

TABLA: detalle_compra
+------------------------+---------------+---------------------------+
| Campo                  | Tipo          | DescripciÃ³n               |
+------------------------+---------------+---------------------------+
| detalle_id             | INT(11)       | ID Ãºnico                  |
| compra_id              | INT(11)       | FK a compras              |
| producto_nombre        | VARCHAR(200)  | Nombre del producto       |
| producto_descripcion   | TEXT          | DescripciÃ³n               |
| cantidad               | INT(11)       | Cantidad comprada         |
| precio_unitario        | DECIMAL(10,2) | Precio por unidad         |
| subtotal               | DECIMAL(12,2) | Cantidad Ã— Precio         |
+------------------------+---------------+---------------------------+

FOREIGN KEY: compra_id â†’ compras(compra_id) ON DELETE CASCADE


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTEGRACIÃ“N CON CUENTAS POR PAGAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cuando se registra una compra A CRÃ‰DITO, el sistema:

1. âœ… Crea automÃ¡ticamente una cuenta por pagar
2. âœ… Usa el mismo nÃºmero de factura
3. âœ… Registra el monto total
4. âœ… Establece vencimiento a 30 dÃ­as
5. âœ… Estado: Pendiente

Esto permite llevar control de:
- CuÃ¡nto se debe a cada proveedor
- Fechas de vencimiento
- Pagos realizados
- Saldos pendientes


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   USO DEL MÃ“DULO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AGREGAR COMPRA:
1. Clic en botÃ³n "Nueva Compra"
2. Buscar y seleccionar proveedor (mÃ­nimo 2 letras)
3. Ingresar NÂ° de factura
4. Agregar tracking (opcional)
5. Seleccionar tipo y mÃ©todo de pago
6. Clic en "Agregar Producto"
   - Nombre del producto
   - DescripciÃ³n (opcional)
   - Cantidad
   - Precio unitario
7. Repetir paso 6 para mÃ¡s productos
8. Aplicar descuento si aplica
9. Verificar resumen total
10. Agregar observaciones (opcional)
11. Clic en "Guardar Compra"

VER DETALLES:
- Clic en el Ã­cono de ojo (ğŸ‘) en la tabla
- Se abre modal con informaciÃ³n completa
- Lista de productos con subtotales

ACTUALIZAR ESTADO:
- Clic en el Ã­cono de actualizar (ğŸ”„) en la tabla
- Seleccionar nuevo estado
- Confirmar cambio

CANCELAR COMPRA:
- Clic en el Ã­cono de eliminar (ğŸ—‘) en la tabla
- Confirmar cancelaciÃ³n
- La compra se marca como "Cancelada"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORTES Y CONSULTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VISTA GENERAL DE COMPRAS:
SELECT * FROM vista_compras 
ORDER BY fecha_compra DESC;

COMPRAS POR PROVEEDOR:
SELECT proveedor, COUNT(*) as total_compras, SUM(monto_total) as total_monto
FROM vista_compras
GROUP BY proveedor
ORDER BY total_monto DESC;

COMPRAS EN TRÃNSITO:
SELECT * FROM vista_compras 
WHERE estado_compra = 'en_transito'
ORDER BY fecha_compra DESC;

ESTADÃSTICAS GENERALES:
CALL sp_estadisticas_compras();

DETALLE DE UNA COMPRA:
CALL sp_detalle_compra(1);  -- Cambia 1 por el ID deseado


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ Error: "Proveedor no existe"
   SoluciÃ³n: Verifica que el proveedor estÃ© activo
   
   SELECT * FROM proveedores WHERE activo = 1;

âŒ Error: "Factura duplicada"
   SoluciÃ³n: El nÃºmero de factura debe ser Ãºnico
   
   SELECT * FROM compras 
   WHERE factura_numero = 'TU_FACTURA' AND activo = 1;

âŒ No aparecen proveedores en la bÃºsqueda
   SoluciÃ³n: Verifica que existan proveedores activos
   
   SELECT COUNT(*) FROM proveedores WHERE activo = 1;

âŒ Error al calcular totales
   SoluciÃ³n: Verifica que todos los productos tengan:
   - Cantidad > 0
   - Precio > 0

âŒ Error 404 en la ruta
   SoluciÃ³n: Verifica la configuraciÃ³n de rutas en
   tu archivo router/index.php

âŒ No se crea cuenta por pagar automÃ¡ticamente
   SoluciÃ³n: Instala primero el mÃ³dulo de Cuentas por Pagar
   ejecutando: database/create_cuentas_pagar.sql


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKFLOW RECOMENDADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: REGISTRAR COMPRA
   Estado: En Espera
   â†“
PASO 2: CONFIRMAR ENVÃO
   Actualizar a: En TrÃ¡nsito
   Agregar/verificar tracking
   â†“
PASO 3: RECIBIR MERCANCÃA
   Actualizar a: Recibida
   Verificar productos fÃ­sicamente
   â†“
PASO 4: INGRESAR A INVENTARIO
   Actualizar a: Inventario
   Registrar en sistema de inventario
   Productos disponibles para venta


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPARACIÃ“N: COMPRAS VS VENTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VENTAS:                          COMPRAS:
- Cliente VIP                    - Proveedor internacional
- Empleado (vendedor)            - No aplica
- Productos del inventario       - Nuevos productos comprados
- Genera ingreso                 - Genera egreso
- Estado: Pendiente/Completada   - Estado: En espera/TrÃ¡nsito/etc.
- Disminuye inventario           - Aumenta inventario
- Relacionado con Cuentas        - Relacionado con Cuentas
  por Cobrar (crÃ©dito clientes)    por Pagar (crÃ©dito proveedores)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRÃ“XIMAS MEJORAS SUGERIDAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ IntegraciÃ³n automÃ¡tica con mÃ³dulo de Inventario
â–¡ CatÃ¡logo de productos frecuentes
â–¡ ImportaciÃ³n masiva desde Excel/CSV
â–¡ Reportes en PDF
â–¡ GrÃ¡ficas de compras por perÃ­odo
â–¡ ComparaciÃ³n de precios entre proveedores
â–¡ Alertas de productos en trÃ¡nsito
â–¡ Historial de cambios de estado
â–¡ Dashboard con mÃ©tricas avanzadas
â–¡ ExportaciÃ³n a Excel


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SOPORTE Y DOCUMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– DocumentaciÃ³n completa:
   docs/MODULO_COMPRAS_README.md

ğŸ“ Archivos principales:
   - Modelo: app/models/Purchase.php
   - Controlador: app/controllers/Admin/PurchaseController.php
   - Vista: app/views/admin/purchase-admin.php
   - JavaScript: public/assets/js/purchase-admin.js

ğŸ—„ï¸ Scripts SQL:
   - database/create_compras.sql

ğŸ”— MÃ³dulos relacionados:
   - Proveedores (requerido)
   - Cuentas por Pagar (opcional pero recomendado)
   - Inventario (integraciÃ³n futura)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Â¡INSTALACIÃ“N COMPLETA!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si seguiste todos los pasos, el mÃ³dulo de Compras estÃ¡ listo.

ğŸŒ Accede a: http://localhost/BarkiOS/admin/compras

âœ¨ CaracterÃ­sticas:
   âœ… Registro completo de compras
   âœ… MÃºltiples productos por compra
   âœ… BÃºsqueda de proveedores en tiempo real
   âœ… Tracking de envÃ­os
   âœ… GestiÃ³n de estados
   âœ… Dashboard de estadÃ­sticas
   âœ… IntegraciÃ³n con Cuentas por Pagar
   âœ… Reportes y consultas SQL

Â¡Ã‰xito! ğŸ‰
