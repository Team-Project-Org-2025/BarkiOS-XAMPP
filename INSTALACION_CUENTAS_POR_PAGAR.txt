═══════════════════════════════════════════════════════════════
   INSTALACIÓN DEL MÓDULO DE CUENTAS POR PAGAR
   Garage Barki - Sistema BarkiOS
═══════════════════════════════════════════════════════════════

✅ ARCHIVOS CREADOS:

1. MODELO (Backend)
   📁 app/models/AccountsPayable.php
   - Gestiona operaciones CRUD de cuentas por pagar
   - Concatena información de proveedores
   - Métodos: getAll(), add(), update(), delete(), registrarPago()

2. CONTROLADOR (Backend)
   📁 app/controllers/Admin/AccountsPayableController.php
   - Maneja peticiones AJAX
   - Validaciones de datos
   - Búsqueda de proveedores
   - Endpoints: add_ajax, get_accounts, search_supplier, etc.

3. VISTA (Frontend)
   📁 app/views/admin/accountsPayable.php
   - Interfaz de usuario adaptada para proveedores
   - Modal de agregar cuenta
   - Tabla de visualización

4. JAVASCRIPT
   📁 public/assets/js/accountsPayable.js
   - Búsqueda en tiempo real de proveedores
   - Validación de formularios
   - Carga dinámica de datos con AJAX

5. BASE DE DATOS
   📁 database/create_cuentas_pagar.sql
   - Script completo de creación de tabla
   - Vista para reportes
   - Trigger automático de vencimiento
   - Procedimiento de estadísticas

6. MIGRACIÓN
   📁 database/migration_add_activo_proveedores.sql
   - Agrega campo 'activo' a tabla proveedores
   - Necesario para eliminación lógica

7. DOCUMENTACIÓN
   📁 docs/CUENTAS_POR_PAGAR_README.md
   - Guía completa del módulo
   - Arquitectura y diseño
   - Troubleshooting


═══════════════════════════════════════════════════════════════
   PASOS DE INSTALACIÓN
═══════════════════════════════════════════════════════════════

PASO 1: ACTUALIZAR TABLA PROVEEDORES
-------------------------------------
1. Abre phpMyAdmin (http://localhost/phpmyadmin)
2. Selecciona la base de datos: barkios_db
3. Ve a la pestaña "SQL"
4. Copia y pega el contenido de:
   database/migration_add_activo_proveedores.sql
5. Haz clic en "Continuar"

✅ Resultado esperado: 
   "Migración completada exitosamente"


PASO 2: CREAR TABLA CUENTAS_PAGAR
----------------------------------
1. En phpMyAdmin, misma base de datos (barkios_db)
2. Ve a la pestaña "SQL"
3. Copia y pega el contenido de:
   database/create_cuentas_pagar.sql
4. Haz clic en "Continuar"

✅ Resultado esperado:
   - Tabla "cuentas_pagar" creada
   - Vista "vista_cuentas_pagar" creada
   - Trigger "trg_actualizar_estado_vencido" creado
   - Procedimiento "sp_estadisticas_cuentas_pagar" creado


PASO 3: VERIFICAR INSTALACIÓN
------------------------------
Ejecuta estos comandos SQL para verificar:

-- Ver estructura de la tabla
DESCRIBE cuentas_pagar;

-- Ver proveedores activos
SELECT * FROM proveedores WHERE activo = 1;

-- Probar procedimiento de estadísticas
CALL sp_estadisticas_cuentas_pagar();

-- Ver vista de reportes
SELECT * FROM vista_cuentas_pagar;


PASO 4: CONFIGURAR RUTAS (SI ES NECESARIO)
-------------------------------------------
Verifica que en tu archivo de rutas (index.php o router) exista:

case '/admin/cuentas-pagar':
case '/admin/accountspayable':
    require_once __DIR__ . '/app/controllers/Admin/AccountsPayableController.php';
    break;


PASO 5: PROBAR EL MÓDULO
-------------------------
1. Inicia XAMPP (Apache + MySQL)
2. Navega a: http://localhost/BarkiOS/admin/cuentas-pagar
   (O la ruta que hayas configurado)
3. Deberías ver la interfaz de Cuentas por Pagar


═══════════════════════════════════════════════════════════════
   DATOS DE PRUEBA (OPCIONAL)
═══════════════════════════════════════════════════════════════

Si no tienes proveedores, crea uno de prueba:

INSERT INTO proveedores (id, nombre_empresa, nombre_contacto, direccion, tipo_rif, activo)
VALUES ('J987654321', 'Distribuidora Fashion USA', 'María González', 'Miami, FL', 'J', 1);

Luego crea una cuenta por pagar de prueba:

INSERT INTO cuentas_pagar 
  (proveedor_id, factura_numero, fecha_emision, fecha_vencimiento, monto_total, estado) 
VALUES 
  ('J987654321', 'FACT-2025-001', CURDATE(), DATE_ADD(CURDATE(), INTERVAL 30 DAY), 10000.00, 'Pendiente');


═══════════════════════════════════════════════════════════════
   USO DEL MÓDULO
═══════════════════════════════════════════════════════════════

AGREGAR CUENTA POR PAGAR:
1. Clic en botón "Agregar cuenta"
2. Ingresa número de factura
3. Busca el proveedor (escribe mínimo 2 letras)
4. Selecciona el proveedor de la lista
5. Ingresa fechas y monto
6. Clic en "Guardar"

VISUALIZAR CUENTAS:
- La tabla muestra todas las cuentas activas
- Ordenadas por fecha de vencimiento
- Con badges de color según estado:
  • Amarillo = Pendiente
  • Verde = Pagada
  • Rojo = Vencida
  • Azul = Parcial


═══════════════════════════════════════════════════════════════
   DIFERENCIAS CON CUENTAS POR COBRAR
═══════════════════════════════════════════════════════════════

CUENTAS POR COBRAR:                CUENTAS POR PAGAR:
- Crédito a clientes VIP           - Crédito de proveedores
- Busca clientes                   - Busca proveedores
- Ventas a crédito                 - Compras a crédito
- Clientes deben a Barki           - Barki debe a proveedores
- Solo clientes VIP                - Todos los proveedores


═══════════════════════════════════════════════════════════════
   ESTRUCTURA DE LA BASE DE DATOS
═══════════════════════════════════════════════════════════════

TABLA: cuentas_pagar
+--------------------+---------------+-------------------------------+
| Campo              | Tipo          | Descripción                   |
+--------------------+---------------+-------------------------------+
| id                 | INT(11)       | ID único (auto-increment)     |
| proveedor_id       | VARCHAR(12)   | RIF del proveedor             |
| factura_numero     | VARCHAR(50)   | Número de factura             |
| fecha_emision      | DATE          | Fecha de emisión              |
| fecha_vencimiento  | DATE          | Fecha de vencimiento          |
| fecha_pago         | DATETIME      | Fecha real de pago            |
| monto_total        | DECIMAL(10,2) | Monto a pagar                 |
| estado             | ENUM          | Pendiente/Pagada/Vencida      |
| activo             | TINYINT(1)    | 1=activo, 0=eliminado         |
| created_at         | TIMESTAMP     | Fecha de creación             |
| updated_at         | TIMESTAMP     | Última actualización          |
+--------------------+---------------+-------------------------------+

FOREIGN KEY: proveedor_id → proveedores(id)


═══════════════════════════════════════════════════════════════
   TROUBLESHOOTING
═══════════════════════════════════════════════════════════════

❌ Error: "Proveedor no existe"
   Solución: Verifica que el proveedor tenga activo=1
   
   SELECT * FROM proveedores WHERE activo = 1;

❌ Error: "Factura duplicada"
   Solución: El número de factura debe ser único
   
   SELECT * FROM cuentas_pagar 
   WHERE factura_numero = 'TU_FACTURA' AND activo = 1;

❌ No aparecen proveedores en la búsqueda
   Solución: Verifica que existan proveedores con activo=1
   y que el controlador esté accesible

❌ Error 404 en la ruta
   Solución: Verifica la configuración de rutas en tu
   archivo router/index.php


═══════════════════════════════════════════════════════════════
   INTEGRACIÓN FUTURA CON MÓDULO DE COMPRAS
═══════════════════════════════════════════════════════════════

Cuando implementes el módulo de Compras:

1. Al registrar una compra a crédito, automáticamente se
   puede crear una cuenta por pagar

2. Vincular la cuenta con los detalles de productos comprados

3. Ver historial completo de compras por proveedor

4. Generar reportes de gastos y deudas


═══════════════════════════════════════════════════════════════
   CARACTERÍSTICAS IMPLEMENTADAS
═══════════════════════════════════════════════════════════════

✅ CRUD completo (Crear, Leer, Actualizar, Eliminar)
✅ Búsqueda en tiempo real de proveedores
✅ Validación de datos (servidor y cliente)
✅ Prevención de SQL injection
✅ Eliminación lógica (soft delete)
✅ Estados automáticos (trigger de vencimiento)
✅ Vista para reportes
✅ Procedimiento de estadísticas
✅ Interfaz responsive
✅ Alertas con SweetAlert2
✅ Formateo de moneda y fechas
✅ Registro de pagos
✅ Badges de estado con colores


═══════════════════════════════════════════════════════════════
   PRÓXIMAS MEJORAS SUGERIDAS
═══════════════════════════════════════════════════════════════

□ Editar cuentas por pagar
□ Dashboard con gráficas
□ Reportes en PDF
□ Notificaciones de vencimiento por email
□ Historial de pagos parciales
□ Exportación a Excel
□ Integración con sistema contable
□ Módulo de Compras completo


═══════════════════════════════════════════════════════════════
   SOPORTE Y DOCUMENTACIÓN
═══════════════════════════════════════════════════════════════

📖 Documentación completa:
   docs/CUENTAS_POR_PAGAR_README.md

📁 Archivos principales:
   - Modelo: app/models/AccountsPayable.php
   - Controlador: app/controllers/Admin/AccountsPayableController.php
   - Vista: app/views/admin/accountsPayable.php
   - JavaScript: public/assets/js/accountsPayable.js

🗄️ Scripts SQL:
   - database/create_cuentas_pagar.sql
   - database/migration_add_activo_proveedores.sql


═══════════════════════════════════════════════════════════════
   ¡INSTALACIÓN COMPLETA!
═══════════════════════════════════════════════════════════════

Si seguiste todos los pasos, el módulo está listo para usar.

Navega a: http://localhost/BarkiOS/admin/cuentas-pagar

¡Éxito! 🎉
