â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MÃ“DULO DE COMPRAS - VERSIÃ“N SIMPLIFICADA
   Sistema BarkiOS - Garage Barki
   Para Ropa Exclusiva (1 prenda = 1 precio Ãºnico)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  IMPORTANTE: CAMBIO DE ESTRUCTURA âš ï¸

Este mÃ³dulo fue rediseÃ±ado para manejar compras de ropa exclusiva
donde CADA PRENDA ES ÃšNICA con su propio precio individual.

Si compraste 20 pantalones, debes registrar 20 prendas individuales,
cada una con su descripciÃ³n y precio especÃ­fico.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ARCHIVOS CREADOS/ACTUALIZADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… BASE DE DATOS:
   ğŸ“ database/create_compras.sql
   - Tabla: compras (NÂ° Factura, Tracking, Comercio, Fecha, Monto Total)
   - Tabla: prendas_compradas (Cada prenda Ãºnica con su precio)
   - Vista: vista_compras (Para consultas)
   - Procedimientos: sp_estadisticas_compras, sp_detalle_compra

âœ… MODELO (Backend):
   ğŸ“ app/models/Purchase.php
   - getAll(): Lista todas las compras
   - getById(): Obtiene compra con sus prendas
   - add(): Registra compra con prendas
   - getCategorias(): Obtiene categorÃ­as de productos
   - markPdfGenerated(): Marca PDF como generado

âœ… CONTROLADOR (Backend):
   ğŸ“ app/controllers/Admin/PurchaseController.php
   - add_ajax: Guardar compra
   - get_purchases: Listar compras
   - get_categorias: Obtener categorÃ­as
   - search_supplier: Buscar proveedores
   - download_pdf: Descargar PDF de compra

âœ… GENERADOR DE PDF:
   ğŸ“ app/utils/PurchasePdfGenerator.php
   - Genera PDF con formato profesional
   - Lista todas las prendas individuales
   - Agrupa por categorÃ­a
   - Muestra monto total

âœ… VISTA (Frontend):
   ğŸ“ app/views/admin/purchase-admin-v2.php  âš ï¸ USAR ESTA
   - Tabla simple: NÂ° Factura, Tracking, Comercio, Fecha, PDF
   - Modal para agregar compra
   - Formulario dinÃ¡mico para prendas

âœ… JAVASCRIPT:
   ğŸ“ public/assets/js/purchase-admin-v2.js  âš ï¸ USAR ESTE
   - Agregar prendas dinÃ¡micamente
   - Calcular total automÃ¡tico
   - Descargar PDF


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INSTALACIÃ“N PASO A PASO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: CREAR/ACTUALIZAR TABLAS EN LA BASE DE DATOS
----------------------------------------------------
1. Abre phpMyAdmin: http://localhost/phpmyadmin
2. Selecciona la base de datos: barkios_db
3. Ve a la pestaÃ±a "SQL"
4. Copia y pega el contenido de:
   database/create_compras.sql
5. Haz clic en "Continuar"

âœ… Resultado esperado:
   - Tabla "compras" creada
   - Tabla "prendas_compradas" creada
   - Vista "vista_compras" creada
   - Procedimientos creados


PASO 2: USAR LOS ARCHIVOS CORRECTOS
------------------------------------
âš ï¸ IMPORTANTE: Usa los archivos con "-v2"

OpciÃ³n A - Renombrar archivos:
   1. Elimina: app/views/admin/purchase-admin.php
   2. Renombra: purchase-admin-v2.php â†’ purchase-admin.php
   
   3. Elimina: public/assets/js/purchase-admin.js
   4. Renombra: purchase-admin-v2.js â†’ purchase-admin.js

OpciÃ³n B - Actualizar la vista directamente:
   Edita: app/views/admin/purchase-admin-v2.php
   LÃ­nea 152, cambia:
   <script src="/BarkiOS/public/assets/js/purchase-admin.js"></script>
   Por:
   <script src="/BarkiOS/public/assets/js/purchase-admin-v2.js"></script>


PASO 3: CONFIGURAR RUTAS
-------------------------
Verifica en tu archivo de rutas (index.php o router):

case '/admin/compras':
case '/admin/purchases':
    require_once __DIR__ . '/app/controllers/Admin/PurchaseController.php';
    break;


PASO 4: INSTALAR TCPDF (LibrerÃ­a PDF)
--------------------------------------
âš ï¸ CRÃTICO: Necesitas TCPDF para generar PDFs

Si no tienes Composer instalado:
   1. Descarga TCPDF de: https://github.com/tecnickcom/TCPDF
   2. Extrae en: vendor/tecnickcom/tcpdf/
   3. AsegÃºrate que existe: vendor/tecnickcom/tcpdf/tcpdf.php

Si tienes Composer:
   composer require tecnick.com/tcpdf


PASO 5: CREAR DIRECTORIO TEMP
------------------------------
Crea el directorio para PDFs temporales:

mkdir public/temp
chmod 777 public/temp


PASO 6: VERIFICAR INSTALACIÃ“N
------------------------------
1. Ejecuta estos comandos SQL:

   -- Ver tablas
   SHOW TABLES LIKE '%compra%';
   
   -- Ver estructura
   DESCRIBE compras;
   DESCRIBE prendas_compradas;
   
   -- Probar procedimiento
   CALL sp_estadisticas_compras();

2. Navega a: http://localhost/BarkiOS/admin/compras


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTRUCTURA DE LA BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TABLA: compras (Encabezado)
+----------------+---------------+--------------------------------+
| Campo          | Tipo          | DescripciÃ³n                    |
+----------------+---------------+--------------------------------+
| compra_id      | INT(11)       | ID Ãºnico                       |
| proveedor_id   | VARCHAR(12)   | RIF del proveedor/comercio     |
| factura_numero | VARCHAR(50)   | NÃºmero de factura (Ãºnico)      |
| fecha_compra   | DATETIME      | Fecha de la compra             |
| tracking       | VARCHAR(100)  | NÃºmero de seguimiento          |
| monto_total    | DECIMAL(12,2) | Total pagado                   |
| pdf_generado   | TINYINT(1)    | Si se generÃ³ el PDF            |
| activo         | TINYINT(1)    | 1=activo, 0=eliminado          |
+----------------+---------------+--------------------------------+

TABLA: prendas_compradas (Detalle - CADA PRENDA ES ÃšNICA)
+---------------------+---------------+--------------------------------+
| Campo               | Tipo          | DescripciÃ³n                    |
+---------------------+---------------+--------------------------------+
| prenda_comprada_id  | INT(11)       | ID Ãºnico                       |
| compra_id           | INT(11)       | FK a compras                   |
| producto_nombre     | VARCHAR(200)  | Nombre/descripciÃ³n completa    |
| categoria           | VARCHAR(100)  | CategorÃ­a (Pantalones, etc)    |
| precio_costo        | DECIMAL(10,2) | Precio de ESTA prenda Ãºnica    |
+---------------------+---------------+--------------------------------+


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CÃ“MO USAR EL MÃ“DULO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ REGISTRAR UNA COMPRA:

1. Clic en "Nueva Compra"

2. Seleccionar Comercio:
   - Escribe mÃ­nimo 2 letras
   - Selecciona de la lista

3. Ingresar Datos:
   - NÂ° de Factura: FACT-USA-2025-001
   - Tracking: TRACK123456 (opcional)

4. Agregar Prendas (Â¡IMPORTANTE!):
   
   Ejemplo: Compraste 20 pantalones Levi's diferentes
   
   Clic en "Agregar Prenda" 20 veces:
   
   Prenda 1:
   - Nombre: PantalÃ³n Levi's 501 Talla 32 Azul Oscuro
   - CategorÃ­a: Pantalones
   - Precio: $45.00
   
   Prenda 2:
   - Nombre: PantalÃ³n Levi's 501 Talla 34 Negro
   - CategorÃ­a: Pantalones
   - Precio: $47.50
   
   Prenda 3:
   - Nombre: PantalÃ³n Levi's 505 Talla 32 Azul Claro
   - CategorÃ­a: Pantalones
   - Precio: $43.00
   
   ... y asÃ­ hasta 20 prendas

5. Verificar Resumen:
   - Total de Prendas: 20
   - Monto Total: $920.00 (ejemplo)

6. Guardar:
   - Clic en "Guardar Compra y Generar PDF"
   - Se guardarÃ¡ en la base de datos
   - El PDF se descargarÃ¡ automÃ¡ticamente


ğŸ“„ EL PDF CONTENDRÃ:

- InformaciÃ³n de la compra (factura, proveedor, fecha)
- Lista COMPLETA de todas las prendas:
  
  # | Prenda                                      | CategorÃ­a  | Precio
  1 | PantalÃ³n Levi's 501 Talla 32 Azul Oscuro  | Pantalones | $45.00
  2 | PantalÃ³n Levi's 501 Talla 34 Negro         | Pantalones | $47.50
  3 | PantalÃ³n Levi's 505 Talla 32 Azul Claro   | Pantalones | $43.00
  ... (todas las 20 prendas)
  
- Monto Total al final


ğŸ“¥ DESCARGAR PDF DESPUÃ‰S:

En la tabla principal, cada compra tiene un botÃ³n "Descargar PDF"
Nombre del archivo: Factura_FACT-USA-001_2025-10-22.pdf


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIFERENCIAS CON LA VERSIÃ“N ANTERIOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES (VersiÃ³n con cantidades):
âŒ Producto: PantalÃ³n Levi's
âŒ Cantidad: 20
âŒ Precio Unitario: $45.00
âŒ Subtotal: $900.00

AHORA (VersiÃ³n simplificada):
âœ… Prenda 1: PantalÃ³n Levi's 501 Talla 32 Azul - $45.00
âœ… Prenda 2: PantalÃ³n Levi's 501 Talla 34 Negro - $47.50
âœ… Prenda 3: PantalÃ³n Levi's 505 Talla 32 Azul - $43.00
âœ… ... (cada prenda es Ãºnica)

VENTAJAS DE LA NUEVA VERSIÃ“N:
âœ… Cada prenda tiene su precio individual
âœ… Mejor control de inventario (cada pieza es Ãºnica)
âœ… PDF detallado con cada artÃ­culo
âœ… Trazabilidad completa
âœ… Refleja la realidad: ropa exclusiva


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CATEGORÃAS DISPONIBLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Por defecto:
- Pantalones
- Camisas
- Vestidos
- Zapatos
- Accesorios
- Chaquetas
- Faldas

El sistema tambiÃ©n obtiene categorÃ­as de la tabla 'prendas' si existe.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATOS DE PRUEBA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- 1. Crear proveedor de prueba
INSERT INTO proveedores (id, nombre_empresa, nombre_contacto, direccion, tipo_rif, activo)
VALUES ('J123456789', 'Fashion Imports NYC', 'Sarah Johnson', 'New York, NY 10001', 'J', 1);

-- 2. Crear una compra de prueba
INSERT INTO compras (proveedor_id, factura_numero, tracking, monto_total)
VALUES ('J123456789', 'FACT-NYC-2025-001', 'TRACK-USA-123456', 2150.00);

-- 3. Obtener el ID de la compra
SET @compra_id = LAST_INSERT_ID();

-- 4. Agregar prendas individuales (ejemplo: 5 prendas)
INSERT INTO prendas_compradas (compra_id, producto_nombre, categoria, precio_costo) VALUES
(@compra_id, 'PantalÃ³n Levi''s 501 Original Talla 32 Azul Oscuro', 'Pantalones', 45.00),
(@compra_id, 'PantalÃ³n Levi''s 501 Original Talla 34 Negro', 'Pantalones', 47.50),
(@compra_id, 'Camisa Ralph Lauren Slim Fit Blanca Talla M', 'Camisas', 65.00),
(@compra_id, 'Camisa Tommy Hilfiger Regular Talla L Azul', 'Camisas', 58.00),
(@compra_id, 'Vestido Calvin Klein Negro Elegante Talla S', 'Vestidos', 120.00);

-- 5. Verificar
SELECT * FROM vista_compras WHERE compra_id = @compra_id;
SELECT * FROM prendas_compradas WHERE compra_id = @compra_id;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ Error: "TCPDF not found"
   SoluciÃ³n: Instalar TCPDF (ver PASO 4)

âŒ Error: "Cannot write to temp directory"
   SoluciÃ³n: 
   mkdir public/temp
   chmod 777 public/temp

âŒ No se descarga el PDF
   SoluciÃ³n: Verifica que TCPDF estÃ© instalado
   y que el directorio temp tenga permisos

âŒ Error: "Debe agregar al menos una prenda"
   SoluciÃ³n: AsegÃºrate de hacer clic en "Agregar Prenda"
   y llenar los campos antes de guardar

âŒ No aparecen comercios en la bÃºsqueda
   SoluciÃ³n: Verifica que haya proveedores activos:
   SELECT * FROM proveedores WHERE activo = 1;

âŒ El PDF estÃ¡ vacÃ­o o con errores
   SoluciÃ³n: Verifica que la compra tenga prendas:
   SELECT * FROM prendas_compradas WHERE compra_id = X;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSULTAS ÃšTILES SQL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Ver todas las compras
SELECT * FROM vista_compras;

-- Ver prendas de una compra especÃ­fica
SELECT * FROM prendas_compradas WHERE compra_id = 1;

-- EstadÃ­sticas generales
CALL sp_estadisticas_compras();

-- Detalle completo de una compra
CALL sp_detalle_compra(1);

-- Compras por proveedor
SELECT proveedor, COUNT(*) as total, SUM(monto_total) as total_gastado
FROM vista_compras
GROUP BY proveedor;

-- Prendas por categorÃ­a
SELECT categoria, COUNT(*) as cantidad, SUM(precio_costo) as total
FROM prendas_compradas pc
INNER JOIN compras c ON pc.compra_id = c.compra_id
WHERE c.activo = 1
GROUP BY categoria;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTAS IMPORTANTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  CADA PRENDA ES ÃšNICA:
   No uses cantidades. Si compraste 50 camisas, debes
   agregar 50 filas individuales, cada una con su
   descripciÃ³n y precio.

ğŸ’¡ NOMBRAMIENTO DESCRIPTIVO:
   SÃ© especÃ­fico en el nombre de cada prenda:
   âœ… "PantalÃ³n Levi's 501 Talla 32 Azul Oscuro Slim Fit"
   âŒ "PantalÃ³n"

ğŸ“„ PDF AUTOMÃTICO:
   Al guardar una compra, el PDF se descarga automÃ¡ticamente.
   TambiÃ©n puedes descargarlo despuÃ©s desde la tabla.

ğŸ—‚ï¸  ORGANIZACIÃ“N POR CATEGORÃAS:
   El PDF agrupa las prendas por categorÃ­a para
   mejor visualizaciÃ³n.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SOPORTE Y ARCHIVOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Archivos principales:
   - SQL: database/create_compras.sql
   - Modelo: app/models/Purchase.php
   - Controlador: app/controllers/Admin/PurchaseController.php
   - Vista: app/views/admin/purchase-admin-v2.php âš ï¸
   - JS: public/assets/js/purchase-admin-v2.js âš ï¸
   - PDF: app/utils/PurchasePdfGenerator.php

ğŸ“– DocumentaciÃ³n:
   - Este archivo: INSTALACION_COMPRAS_SIMPLIFICADO.txt
   - README anterior: docs/MODULO_COMPRAS_README.md (obsoleto)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Â¡INSTALACIÃ“N COMPLETA!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Sigue los 6 pasos de instalaciÃ³n y estarÃ¡s listo para:
âœ… Registrar compras de ropa exclusiva
âœ… Agregar prendas individuales con sus precios
âœ… Generar PDFs profesionales automÃ¡ticamente
âœ… Descargar informes en cualquier momento
âœ… Llevar control exacto de cada pieza comprada

Accede a: http://localhost/BarkiOS/admin/compras

Â¡Ã‰xito! ğŸ‰
